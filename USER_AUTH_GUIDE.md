# Westdale Cafe ç”¨æˆ·è®¤è¯ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®å·²æˆåŠŸé›†æˆäº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ŒåŸºäº Supabase Auth æ„å»ºï¼Œæä¾›å®‰å…¨çš„ç”¨æˆ·ç™»å½•ã€æ³¨å†Œå’Œæ•°æ®éš”ç¦»åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” ç”¨æˆ·è®¤è¯
- ç”¨æˆ·æ³¨å†Œï¼ˆé‚®ç®±éªŒè¯ï¼‰
- ç”¨æˆ·ç™»å½•/ç™»å‡º
- å¯†ç é‡ç½®
- ä¼šè¯ç®¡ç†

### ğŸ‘¤ ç”¨æˆ·ç®¡ç†
- ä¸ªäººèµ„æ–™ç®¡ç†
- åå¥½è®¾ç½®
- å¯†ç æ›´æ–°
- è´¦æˆ·ä¿¡æ¯ç»Ÿè®¡

### ğŸ”’ æ•°æ®å®‰å…¨
- è¡Œçº§å®‰å…¨ç­–ç•¥ï¼ˆRLSï¼‰
- ç”¨æˆ·æ•°æ®å®Œå…¨éš”ç¦»
- è‡ªåŠ¨æ•°æ®æ¸…ç†ï¼ˆçº§è”åˆ é™¤ï¼‰

### ğŸ“Š ç”¨æˆ·åŠŸèƒ½
- æ”¶è—åŠŸèƒ½ï¼ˆæ·»åŠ ã€ç§»é™¤ã€æŸ¥çœ‹ï¼‰
- ç”¨æˆ·è¯„ä»·ç³»ç»Ÿ

## æ–‡ä»¶ç»“æ„

### æ•°æ®åº“è®¾ç½®
- `user-auth-setup.sql` - å®Œæ•´çš„æ•°æ®åº“è®¾ç½®è„šæœ¬

### å‰ç«¯æ–‡ä»¶
- `login.html` - ç™»å½•/æ³¨å†Œé¡µé¢
- `profile.html` - ç”¨æˆ·ä¸ªäººèµ„æ–™é¡µé¢
- `js/auth.js` - è®¤è¯ç³»ç»Ÿ JavaScript æ¨¡å—

### æ›´æ–°çš„æ–‡ä»¶
- `index.html` - æ·»åŠ äº†ç”¨æˆ·èœå•å’Œè®¤è¯çŠ¶æ€æ˜¾ç¤º

## æ•°æ®åº“è¡¨ç»“æ„

### ç”¨æˆ·é…ç½®è¡¨ (user_profiles)
```sql
- id (UUID) - å…³è”åˆ° auth.users
- display_name (VARCHAR) - æ˜¾ç¤ºåç§°
- avatar_url (TEXT) - å¤´åƒURL
- phone (VARCHAR) - ç”µè¯å·ç 
- address (TEXT) - åœ°å€
- preferences (JSONB) - ç”¨æˆ·åå¥½è®¾ç½®
- created_at/updated_at - æ—¶é—´æˆ³
```



### ç”¨æˆ·æ”¶è—è¡¨ (user_favorites)
```sql
- id (UUID) - ä¸»é”®
- user_id (UUID) - ç”¨æˆ·ID
- menu_item_id (INTEGER) - èœå•é¡¹ç›®ID
- created_at - åˆ›å»ºæ—¶é—´
```

### ç”¨æˆ·è¯„ä»·è¡¨ (user_reviews)
```sql
- id (UUID) - ä¸»é”®
- user_id (UUID) - ç”¨æˆ·ID
- menu_item_id (INTEGER) - èœå•é¡¹ç›®ID
- rating (INTEGER) - è¯„åˆ† (1-5)
- comment (TEXT) - è¯„ä»·å†…å®¹
- created_at/updated_at - æ—¶é—´æˆ³
```

## å®‰è£…æ­¥éª¤

### 1. æ•°æ®åº“è®¾ç½®
åœ¨ Supabase æ§åˆ¶å°ä¸­æ‰§è¡Œ `user-auth-setup.sql` è„šæœ¬ï¼š

```sql
-- è¿è¡Œ user-auth-setup.sql ä¸­çš„æ‰€æœ‰SQLè¯­å¥
-- è¿™å°†åˆ›å»ºæ‰€æœ‰å¿…è¦çš„è¡¨ã€æ”¿ç­–ã€å‡½æ•°å’Œè§¦å‘å™¨
```

### 2. é…ç½®é‚®ä»¶æœåŠ¡
åœ¨ Supabase æ§åˆ¶å°çš„ Authentication > Settings ä¸­é…ç½®ï¼š
- Email templatesï¼ˆé‚®ä»¶æ¨¡æ¿ï¼‰
- SMTP settingsï¼ˆSMTPè®¾ç½®ï¼‰
- Redirect URLsï¼ˆé‡å®šå‘URLï¼‰

### 3. å¯ç”¨è®¤è¯åŠŸèƒ½
åœ¨ Supabase æ§åˆ¶å°çš„ Authentication > Settings ä¸­å¯ç”¨ï¼š
- Email confirmations
- Password recovery
- æ ¹æ®éœ€è¦é…ç½®å…¶ä»–é€‰é¡¹

## ä½¿ç”¨æ–¹æ³•

### ç”¨æˆ·æ³¨å†Œæµç¨‹
1. è®¿é—® `login.html` é¡µé¢
2. ç‚¹å‡»"æ³¨å†Œ"æ ‡ç­¾
3. å¡«å†™ç”¨æˆ·ä¿¡æ¯ï¼ˆæ˜¾ç¤ºåç§°ã€é‚®ç®±ã€å¯†ç ï¼‰
4. ç³»ç»Ÿå‘é€ç¡®è®¤é‚®ä»¶
5. ç”¨æˆ·ç‚¹å‡»é‚®ä»¶ä¸­çš„ç¡®è®¤é“¾æ¥
6. æ³¨å†Œå®Œæˆï¼Œè‡ªåŠ¨åˆ›å»ºç”¨æˆ·é…ç½®

### ç”¨æˆ·ç™»å½•æµç¨‹
1. è®¿é—® `login.html` é¡µé¢
2. è¾“å…¥é‚®ç®±å’Œå¯†ç 
3. ç‚¹å‡»ç™»å½•
4. æˆåŠŸåé‡å®šå‘åˆ°é¦–é¡µ
5. å¯¼èˆªæ æ˜¾ç¤ºç”¨æˆ·èœå•

### ä¸ªäººèµ„æ–™ç®¡ç†
1. ç™»å½•åç‚¹å‡»ç”¨æˆ·èœå•ä¸­çš„"ä¸ªäººèµ„æ–™"
2. åœ¨"åŸºæœ¬ä¿¡æ¯"æ ‡ç­¾é¡µç¼–è¾‘ä¸ªäººä¿¡æ¯
3. åœ¨"åå¥½è®¾ç½®"æ ‡ç­¾é¡µè®¾ç½®å’–å•¡åå¥½å’Œé€šçŸ¥é€‰é¡¹
4. åœ¨"å®‰å…¨è®¾ç½®"æ ‡ç­¾é¡µä¿®æ”¹å¯†ç 

### æ•°æ®éš”ç¦»æœºåˆ¶
ç³»ç»Ÿä½¿ç”¨ Supabase çš„è¡Œçº§å®‰å…¨ç­–ç•¥ï¼ˆRLSï¼‰ç¡®ä¿ï¼š
- ç”¨æˆ·åªèƒ½æŸ¥çœ‹å’Œä¿®æ”¹è‡ªå·±çš„æ•°æ®
- è‡ªåŠ¨è¿‡æ»¤æŸ¥è¯¢ç»“æœï¼Œé˜²æ­¢æ•°æ®æ³„éœ²
- æ‰€æœ‰ç”¨æˆ·ç›¸å…³è¡¨éƒ½å—åˆ°ä¿æŠ¤

## API ä½¿ç”¨ç¤ºä¾‹

### è®¤è¯ç®¡ç†
```javascript
import { authManager } from './js/auth.js';

// ç”¨æˆ·æ³¨å†Œ
const result = await authManager.signUp(email, password, displayName);

// ç”¨æˆ·ç™»å½•
const result = await authManager.signIn(email, password);

// ç”¨æˆ·ç™»å‡º
const result = await authManager.signOut();

// æ£€æŸ¥ç™»å½•çŠ¶æ€
const isLoggedIn = authManager.isAuthenticated();

// è·å–å½“å‰ç”¨æˆ·
const user = authManager.getCurrentUser();

// æ›´æ–°ç”¨æˆ·é…ç½®
const result = await authManager.updateUserProfile(profileData);
```

### æ”¶è—ç®¡ç†
```javascript
import { favoritesManager } from './js/auth.js';

// æ·»åŠ æ”¶è—
const result = await favoritesManager.addFavorite(menuItemId);

// ç§»é™¤æ”¶è—
const result = await favoritesManager.removeFavorite(menuItemId);

// è·å–ç”¨æˆ·æ”¶è—
const result = await favoritesManager.getUserFavorites();

// æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
const isFavorited = await favoritesManager.isFavorite(menuItemId);
```

## å®‰å…¨è€ƒè™‘

### æ•°æ®ä¿æŠ¤
- æ‰€æœ‰ç”¨æˆ·æ•°æ®éƒ½é€šè¿‡ RLS æ”¿ç­–ä¿æŠ¤
- å¯†ç ä½¿ç”¨ Supabase æ ‡å‡†åŠ å¯†
- ä¼šè¯ç®¡ç†ç”± Supabase Auth å¤„ç†

### è¾“å…¥éªŒè¯
- å‰ç«¯å’Œåç«¯éƒ½è¿›è¡Œæ•°æ®éªŒè¯
- SQL æ³¨å…¥é˜²æŠ¤ï¼ˆä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- XSS é˜²æŠ¤ï¼ˆè¾“å…¥è½¬ä¹‰ï¼‰

### è®¿é—®æ§åˆ¶
- å—ä¿æŠ¤é¡µé¢è‡ªåŠ¨é‡å®šå‘æœªç™»å½•ç”¨æˆ·
- API è°ƒç”¨éœ€è¦æœ‰æ•ˆçš„è®¤è¯ä»¤ç‰Œ
- æ•æ„Ÿæ“ä½œéœ€è¦é‡æ–°éªŒè¯

## é”™è¯¯å¤„ç†

ç³»ç»Ÿæä¾›å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š
- ç½‘ç»œé”™è¯¯å¤„ç†
- è®¤è¯å¤±è´¥å¤„ç†
- æ•°æ®éªŒè¯é”™è¯¯å¤„ç†
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

## æ‰©å±•åŠŸèƒ½

### å¯æ·»åŠ çš„åŠŸèƒ½
1. ç¤¾äº¤ç™»å½•ï¼ˆGoogleã€Facebookç­‰ï¼‰
2. åŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰
3. ç”¨æˆ·è§’è‰²å’Œæƒé™ç®¡ç†
4. ç”¨æˆ·æ´»åŠ¨æ—¥å¿—
5. æ•°æ®å¯¼å‡ºåŠŸèƒ½

### è‡ªå®šä¹‰é€‰é¡¹
1. é‚®ä»¶æ¨¡æ¿å®šåˆ¶
2. ç”¨æˆ·ç•Œé¢ä¸»é¢˜
3. ä¸šåŠ¡é€»è¾‘æ‰©å±•
4. ç¬¬ä¸‰æ–¹é›†æˆ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **é‚®ä»¶æœªæ”¶åˆ°** - æ£€æŸ¥ SMTP é…ç½®å’Œåƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹
2. **ç™»å½•å¤±è´¥** - éªŒè¯é‚®ç®±ç¡®è®¤çŠ¶æ€
3. **æ•°æ®åŠ è½½å¤±è´¥** - æ£€æŸ¥ RLS æ”¿ç­–é…ç½®
4. **æƒé™é”™è¯¯** - ç¡®è®¤ç”¨æˆ·è®¤è¯çŠ¶æ€

### è°ƒè¯•å·¥å…·
- æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- Supabase æ§åˆ¶å°æ—¥å¿—
- ç½‘ç»œè¯·æ±‚ç›‘æ§

## è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°æŠ€æœ¯é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. æŸ¥çœ‹ Supabase é¡¹ç›®æ—¥å¿—
3. å‚è€ƒ Supabase å®˜æ–¹æ–‡æ¡£
4. è”ç³»å¼€å‘å›¢é˜Ÿ

---

*æ­¤æ–‡æ¡£å°†æ ¹æ®ç³»ç»Ÿæ›´æ–°å’Œç”¨æˆ·åé¦ˆæŒç»­æ”¹è¿›ã€‚* 